{"version":3,"file":"single-spa.js","sources":["../../src/applications/apps.helper.js","../../src/start.js","../../src/lifecycles/helper.js","../../src/lifecycles/load.js","../../src/navigation/invoke.js","../../src/applications/apps.js"],"sourcesContent":["'use strict'\r\n/**\r\n * 未加载\r\n */\r\nexport const NO_LOADED = 'NO_LOADED'\r\n/**\r\n * 未跳过\r\n */\r\nexport const NOT_SKIP = 'NOT_SKIP'\r\n/**\r\n * 执行错误\r\n */\r\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN'\r\n/**\r\n * 加载错误\r\n */\r\nexport const LOAD_ERROR = \"LOAD_ERROR\"\r\n/**\r\n * 加载源代码\r\n */\r\nexport const LOAD_SOURCE_CODE = 'LOAD_SOURCE_CODE'\r\n// 没有错误 \r\nexport function noSkip (app) {\r\n  return app.status !== SKIP_BECAUSE_BROKEN\r\n}\r\n// 没有致命的加载错误\r\nexport function noLoadError (app) {\r\n  return app.status !== LOAD_ERROR\r\n\r\n}\r\n// 未加载\r\nexport function isntLoaded (app) {\r\n  return app.status === NO_LOADED\r\n}\r\n// 应该被执行\r\nexport function shouldBeActivity (app) {\r\n  try {\r\n    return app.activityWhen(window.location)\r\n  } catch (e) {\r\n    app.status === SKIP_BECAUSE_BROKEN\r\n    console.log(\"ERROR\", e);\r\n\r\n  }\r\n}\r\n","\"use strict\";\r\nlet started = false\r\nexport function start () {\r\n\r\n}\r\nexport function isStarted () {\r\n  return started\r\n}","\"use strict\"\r\n// 判断是不是一个promise\r\nexport function lookLikePromise (promise) {\r\n  // 判断是不是Promise实例\r\n  if (promise instanceof Promise) {\r\n    return true\r\n  }\r\n  // 判断自定义Pormise\r\n  return typeof promise === 'object' && typeof promise.then() === 'fucntion' && typeof promise.catch === 'function'\r\n\r\n}\r\n","'use strict'\r\nimport { NO_LOADED, LOAD_SOURCE_CODE, SKIP_BECAUSE_BROKEN } from '../applications/apps.helper'\r\nimport { lookLikePromise } from './helper'\r\nexport function toloadPromise (app) {\r\n  if (app.status !== NO_LOADED) {\r\n    return Promise.resolve(app)\r\n  }\r\n  app.status = LOAD_SOURCE_CODE\r\n  // 加载程序\r\n  let loadPromise = app.loadFunction()\r\n  // 判断返回的是不是一个promise\r\n  if (!lookLikePromise()) {\r\n    return Promise.reject(new Error(\"\"));\r\n  }\r\n  loadPromise.then(appConfig => {\r\n    // appCofig必须是一个对象，包含app的生命周期等等信息\r\n    if (typeof appConfig !== 'object') {\r\n      throw new Error(\"\")\r\n    }\r\n    // app生命周期：bootstrap，mount，unmount\r\n    let errors = []\r\n    ['bootstrap', 'mount', 'unmount'].forEach(lifecycle => {\r\n      if (!appConfig[lifecycle]) {\r\n        errors.push('lifecycle:' + lifecycle + 'must be exists')\r\n      }\r\n    })\r\n    if (errors.length > 0) {\r\n      // 状态不合法\r\n      app.status = SKIP_BECAUSE_BROKEN\r\n      console.log(\"load.js\", errors);\r\n      return\r\n    }\r\n    app.bootstrap = appConfig.bootstrap\r\n  })\r\n}","\"use strict\"\r\nimport { isStarted } from '../start'\r\nimport { getAppsToload } from '../applications/apps'\r\nimport { toloadPromise } from '../lifecycles/load'\r\nlet appChangesUnderway = false\r\nlet changeQueue = []\r\nexport function invoke () {\r\n  if (appChangesUnderway) {\r\n    return new Promise((resolve, reject) => {\r\n      changeQueue.push(\r\n        {\r\n          success: resolve,\r\n          failure: reject\r\n        }\r\n      )\r\n    })\r\n  }\r\n  appChangesUnderway = true\r\n  if (isStarted()) {\r\n\r\n  } else {\r\n    loadApps()\r\n  }\r\n  function loadApps () {\r\n    // 获取需要load 的app\r\n    getAppsToload().map(toloadPromise)\r\n  }\r\n}","\r\n'use strict'\r\nimport { NO_LOADED, noSkip, noLoadError, isntLoaded, shouldBeActivity } from './apps.helper'\r\nimport { invoke } from '../navigation/invoke'\r\n/**\r\n * \r\n * @param {要注册的app的名称} appName \r\n * @param {Function<Promise>||Object，app异步加载函数或者app内容} loadFunction \r\n * @param {Function<Boolean> 触发时机} activityWhen \r\n * @param {Object 自定义配置} customProps \r\n * return Promise\r\n */\r\n\r\nconst apps = []\r\nexport function registerApplication (appName, loadFunction, activityWhen, customProps) {\r\n  if (!appName || typeof appName !== 'string') {\r\n    throw new Error(\"appName must be a non-empty string\")\r\n  }\r\n  if (!loadFunction) {\r\n    throw new Error(\"loadFunction must be a Function or Object\")\r\n  }\r\n  if (typeof loadFunction !== 'function') {\r\n    loadFunction = () => Promise.resolve(loadFunction)\r\n  }\r\n  if (typeof activityWhen !== 'function') {\r\n    throw new Error(\"activityWhen must be a function\")\r\n  }\r\n  apps.push({\r\n    name: appName,\r\n    loadFunction,\r\n    activityWhen,\r\n    customProps,\r\n    status: NO_LOADED\r\n  })\r\n  invoke()\r\n}\r\nexport function getAppsToload () {\r\n  console.log(\"啥也没拿到\", apps)\r\n  return apps.filter(noSkip).filter(noLoadError).filter(isntLoaded).filter(shouldBeActivity)\r\n}"],"names":["NO_LOADED","SKIP_BECAUSE_BROKEN","LOAD_ERROR","LOAD_SOURCE_CODE","noSkip","app","status","noLoadError","isntLoaded","shouldBeActivity","activityWhen","window","location","e","console","log","start","lookLikePromise","promise","Promise","then","catch","toloadPromise","resolve","loadPromise","loadFunction","reject","Error","appConfig","errors","forEach","lifecycle","push","length","bootstrap","appChangesUnderway","invoke","loadApps","getAppsToload","map","apps","registerApplication","appName","customProps","name","filter"],"mappings":"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"}